name: lm eval on dpo on 60537 (9988)
debug: false
workspace: agnieszka
project: llm-blog3-test
environment:
  environment_variables:
    - NCCL_DEBUG=INFO
    - TRANSFORMERS_CACHE=/nvmefs1/agnieszka.ciborowska
    - HF_DATASETS_CACHE=/nvmefs1/agnieszka.ciborowska
    - HF_HOME=/nvmefs1/agnieszka.ciborowska
    - HF_MODULES_CACHE=/nvmefs1/agnieszka.ciborowska
  image: determinedai/genai-train:latest
resources:
  slots_per_trial: 1
  resource_pool: A100
  max_slots: 4
searcher:
  name: grid
  max_length:
    batches: 5000
  metric: eval_accuracy
  smaller_is_better: false
hyperparameters:
  model_args:
    # hf_model_name: "google/gemma-2b-it"
    # model_ckpt: "dcb7e618-4e8f-402e-8013-f5cab1ff9eb7" # 9989: sft basic
    # model_ckpt: "0ac7dcf3-7e53-4432-8303-26d2af67c664" # 9988: sft completions
    # model_ckpt: "eb1a1782-d1d8-40f7-90e6-2a09827aa6b9" # 9987: sft special tokens
    # model_ckpt: "6b6fbaa7-faa9-4449-867b-2939a147a335"  # 9986: sft special tokens + completions
    # model_ckpt: "3081c7ed-59c1-46ea-976c-2f6126027dbc" # 59055: dpo on 9986
    # model_ckpt: "28218dcb-32d3-432b-8d13-74f8fc2e90bb" # 60038: dpo on 9989
    # model_ckpt: "b5755eeb-f66b-46c5-951d-4f5044a6d740" # 60032: dpo on 9989
    # model_ckpt: "9b68419f-8b4a-4fec-994b-dbb50c62e746" # 60031: dpo on 9989
    # model_ckpt: "1678c1b4-47e4-4403-8139-e57dbb77a8ab" # 59053: dpo on 9986
    # model_ckpt: "092ca394-d81c-4b78-a9e9-43da0135d662" # 60542: dpo on 9987
    # model_ckpt: "c70e3bbb-432f-46f5-a149-dce891580aa0" # 60545: dpo on 9987
    # model_ckpt: "b2f2cadf-58c2-4552-9678-3fa78e3004ab" # 60533: dpo on 9988
    # model_ckpt: "e4bc46cd-76c2-470f-a88f-1e5e467deaa7" # 60531: dpo on 9988
    # model_ckpt: "2f937e10-b0db-41de-8d7c-3228d91148ab" # 60537: dpo on 9988
    trust_remote_code: true
    use_accelerate: false
  batch_size: 4
  max_batch_size: 4
  task:
    type: categorical
    vals:
      - name: arc_challenge
        num_fewshot: 25
      - name: truthfulqa_mc
        num_fewshot: 0
      - name: hellaswag
        num_fewshot: 10
      - name: hendrycks*
        num_fewshot: 5
      - name: winogrande
        num_fewshot: 5
      - name: gsm8k
        num_fewshot: 5
  device: "cuda"
entrypoint: >-
  python run_lm_eval_harness.py
max_restarts: 0
bind_mounts:
  - container_path: /nvmefs1/agnieszka.ciborowska
    host_path: /nvmefs1/agnieszka.ciborowska
    propagation: rprivate
    read_only: false